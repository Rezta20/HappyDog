<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Font  -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome  -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />

    <!-- React  -->
    <script src="https://unpkg.com/react@16.13.1/umd/react.development.js"></script>
    <!-- React DOM -->
    <script src="https://unpkg.com/react-dom@16.13.1/umd/react-dom.development.js"></script>
    <!-- JSX Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="../../css/navbar.css" />
    <link rel="stylesheet" href="../../css/photowall.css" />

    <!-- Favicon  -->
    <link rel="icon" type="image/png" href="../img/favicon.png" />

    <title>Happy Dog</title>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar-ForMobie">
      <!-- Logo -->
      <div class="navbar-logoLoginWrapper">
        <div class="navbar-logoWrapper">
          <a class="logo-A" href="/Html/homepage.html">
            <img class="logo" src="../../img/logo.png" alt="happyDog-logo" />
          </a>
        </div>

        <!-- Navbar Log In  -->
        <div class="login-wrapper notLoginState">
          <a class="login-A" href="/Html/Login/login.html">
            <button class="navbar-text loginBtn">登入</button>
          </a>
        </div>

        <div class="login-wrapper loginState">
          <p class="navbar-text">
            汪，您目前是登入中 。<span
              ><a class="login-A toMemberpage" href="/Html/Login/member.html">
                查看會員資料
              </a></span
            >
          </p>
        </div>
      </div>

      <!-- Navbar Elements -->
      <div class="navbariconWrapperFlex">
        <div class="navbar-iconWrapper">
          <div class="navbar-element">
            <a class="navbar-A" href="/Html/homepage.html">
              <div class="navbarIcon homeIcon"></div>
              <div class="navbar-text">寵物當家</div>
            </a>
          </div>
          <div class="navbar-element">
            <a class="navbar-A" href="/Html/Booking/bookingWalking.html">
              <div class="navbarIcon bookingWalkingIcon"></div>
              <div class="navbar-text">預約散步</div>
            </a>
          </div>
          <div class="navbar-element">
            <a class="navbar-A" href="/Html/photowall.Html">
              <div class="navbarIcon photoIcon"></div>
              <div class="navbar-text">毛孩日誌</div>
            </a>
          </div>
          <div class="navbar-element">
            <a class="navbar-A" href="/Html/Contact/Contact.html">
              <div class="navbarIcon contactIcon"></div>
              <div class="navbar-text">聯絡我們</div>
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Content -->
    <div class="rootWrapper">
      <div id="root"></div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="footer-background"></div>
    </footer>

    <script src="../../JavaScript/ifLogin.js"></script>

    <script type="text/babel">
      function StarDark(props) {
        console.log(props.starDark);
        // <i className="fas fa-star"></i>
        const star = [];
        for (let i = 0; i < props.starDark; i++) {
          star.push(<i className="fas fa-star"></i>);
        }

        return <div>{star}</div>;
      }

      function StarLight(props) {
        console.log(props.starLight);
        const star = [];
        for (let i = 0; i < props.starLight; i++) {
          star.push(<i className="far fa-star"></i>);
        }
        return <div>{star}</div>;
      }

      function Card(props) {
        return (
          <div className="cardWrapper">
            <img
              className="traingImg"
              src={props.trainingImgUrl}
              alt={props.trainingImgAlt}
            />
            <div className="titleStarWrapper">
              <div className="title">{props.title}</div>
              <div className="star">
                <StarDark starDark={props.starDark} />
                <StarLight starLight={props.starLight} />
              </div>
            </div>
            <div className="cardContent">{props.cardContent}</div>
            <button
              className="moreBtn"
              onClick={() => {
                props.setShow(true);
                props.setIndex(props.index);
              }}
            >
              了解更多
            </button>
          </div>
        );
      }

      function UploadCard(props) {
        const [previewFile, setPreviewFile] = React.useState();

        function previewPicture() {
          document.querySelector(".previewText").style.display = "none";
          document
            .querySelector(".previewPicture")
            .setAttribute(
              "style",
              "width:320px; height: 401px; object-fit:contain"
            );
          setPreviewFile(URL.createObjectURL(event.target.files[0]));
        }
        return (
          <div class="uploadCardWrapperFlex">
            <div
              class="cover"
              onClick={() => {
                props.setShowUpload(false);
              }}
            ></div>
            <div className="uploadCardWrapper">
              <div className="crossWrapper">
                <i
                  class="fas fa-times"
                  onClick={() => {
                    props.setShowUpload(false);
                  }}
                ></i>
              </div>
              <div className="uploadContentWrapper">
                <div className="uploadArea">
                  <p className="previewText">預覽圖片</p>
                  <img className="previewPicture" src={previewFile} alt="" />
                </div>
                <label for="upload">
                  <i class="fas fa-file-upload fa-2x"></i>
                </label>
                <input
                  type="file"
                  id="upload"
                  name="image"
                  accept="image/jpg, image/png, image/svg"
                  onChange={previewPicture}
                />
                <textarea
                  type="text"
                  className="hashtagInput"
                  placeholder="寫下你想加的標籤"
                ></textarea>
              </div>
              <div class="sendPhotoBtnWrapper">
                <button className="sendPhotoBtn"> 確認送出</button>
              </div>
            </div>
          </div>
        );
      }

      function CardGroup(props) {
        const [show, setShow] = React.useState(false);
        const [index, setIndex] = React.useState(0);
        const [data, setData] = React.useState([]);
        const [showUpload, setShowUpload] = React.useState(false);

        React.useEffect(() => {
          // Firebase firestore initializ
          const db = firebase.firestore();
          const firestoreCollection = db.collection("photowall");

          firestoreCollection.get().then(function (doc) {
            const dataArray = [];
            doc.forEach(function (doc) {
              dataArray.push(doc.data());
            });
            setData(dataArray);
            console.log("hi");
          });
        }, []);
        console.log(data);

        const cards = [];

        for (let i = 0; i < data.length; i++) {
          cards.push(
            <Card
              key={i}
              trainingImgUrl={data[i].photo}
              trainingImgAlt={data[i].imgAlt}
              title={data[i].user}
              starDark={data[i].starD}
              starLight={data[i].starL}
              // cardContent={data[i].hashtag[0]}
              setShow={setShow}
              setIndex={setIndex}
              index={i}
            />
          );
        }

        let popupcard;

        // setShow(true)
        if (show) {
          popupcard = (
            <Popupcard
              setShow={setShow}
              popupImgSrc={data[index].imgUrl}
              popupImgAlt={data[index].imgAlt}
              name={data[index].titleData}
              starDark={data[index].starD}
              starLight={data[index].starL}
              simpleContent={data[index].cardData}
            />
          );
        }

        return (
          <>
            <button
              className="uploadBtn"
              onClick={() => {
                setShowUpload(true);
              }}
            >
              上傳圖片
            </button>
            {showUpload && <UploadCard setShowUpload={setShowUpload} />}
            <div className="cardsWrapper">
              {cards}
              {popupcard}
            </div>
          </>
        );
      }

      function Popupcard(props) {
        return (
          <div
            className="cover"
            onClick={() => {
              props.setShow(false);
            }}
          >
            <div
              className="popupWrapper"
              onClick={(e) => {
                e.stopPropagation();
              }}
            >
              <div
                className="cross"
                onClick={() => {
                  props.setShow(false);
                }}
              >
                <i className="far fa-times-circle"></i>
              </div>
              <div className="upperWrapper">
                <img
                  className="popUpImg"
                  src={props.popupImgSrc}
                  alt={props.popupImgAlt}
                />

                <div className="upperContentWrapper">
                  <div className="starName">
                    <div className="name">{props.name}</div>
                    <div className="star">
                      <StarDark starDark={props.starDark} />
                      <StarLight starLight={props.starLight} />
                    </div>
                  </div>
                  <div className="simpleContent">{props.simpleContent}</div>
                </div>
              </div>
              <div className="trainingContent">
                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Nobis
                nemo placeat nihil similique, rerum repellendus provident
                aliquam? Illo ex eos vitae explicabo fugit ipsa minus, lorem
                recusandae nihil itaque impedit doloremque! Lorem ipsum dolor
                sit amet consectetur adipisicing elit. Maiores excepturi, at
                similique eos aut optio odio impedit repudiandae doloribus
                sapiente! Ducimus soluta dicta quo doloribus delectus adipisci
                sint unde eveniet.
              </div>
              <div className="youtube"></div>
            </div>
          </div>
        );
      }

      ReactDOM.render(<CardGroup />, document.getElementById("root"));
    </script>

    <!-- FrieBase  -->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-analytics.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-firestore.js"></script>

    <script>
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyBL9Tmhwb15yAohPn_DLoAFUgVJoy76bnk",
        authDomain: "happydog-82c2f.firebaseapp.com",
        databaseURL: "https://happydog-82c2f.firebaseio.com",
        projectId: "happydog-82c2f",
        storageBucket: "happydog-82c2f.appspot.com",
        messagingSenderId: "1070136598571",
        appId: "1:1070136598571:web:0de4a08e0493465e984a6e",
        measurementId: "G-N3V1TLZNZW",
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
    </script>
  </body>
</html>
